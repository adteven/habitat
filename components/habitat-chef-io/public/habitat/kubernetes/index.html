<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta name="robots" content="">
  <title>Kubernetes Development Patterns</title>
  <link rel="shortcut icon" type="image/png" href="/images/favicon.ico" />
  
  
  <link rel="stylesheet" href="/sass/main.css" />
  <link rel="stylesheet" href="/css/habitat.css" />
</head>

<body>
  <a class="skip-main" href="#main-content-col">Skip to main content</a>

  <nav id="utility-bar" class = "show-for-medium">
    <div class="utility-bar-logo">
      <a href="/"><img src="/images/chef-logo.svg" alt="Chef Documentation" class="chef"></a>
    </div>

    <ul class="menu align-right top-nav">
      
      <li><a href="https://www.chef.io/">Chef.io</a></li>
      
      <li><a href="https://learn.chef.io/">Learn Chef</a></li>
      
      <li><a href="https://blog.chef.io/">Blog</a></li>
      
      <li><a href="https://community.chef.io/">Community</a></li>
      
      <li><a href="https://training.chef.io/">Training</a></li>
      
      <li><a href="https://downloads.chef.io/">Download</a></li>
      
    </ul>
</nav>

  <nav id="utility-bar" class = "show-for-small-only">
  <div class="">
    <button id="header-toggle" type="button" class="utility-bar-nav-bars " data-toggle="left-nav-off-canvas">
      <i class="fas fa-bars fa-lg"></i>
    </button>
    <div class="utility-bar-logo">
      <a href="/"><img src="/images/chef-logo.svg" alt="Chef Documentation" class="chef"></a>
    </div>
  </div>
</nav>


  <div id="left-nav-off-canvas" class="hide-for-medium" data-toggler=".reveal">
    


<aside class="sticky" data-sticky data-top-anchor="utility-bar:bottom" data-btm-anchor="footer:top" data-margin-top="0" data-margin-bottom="2">
  <div>
    <button class="close-button" data-toggle="left-nav-off-canvas">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <nav id="sidebar-nav" class="offCanvas">
    
      <div class="search">
        <form class="basic-form" method="" action="">
          <input type="text" class="st-default-search-input" placeholder="Search...">
        </form>
      </div>
    
    <div class="nav">
      <ul class="vertical menu accordion-menu" data-accordion-menu>
        
          
          
        
          
          
        
          
          
            
              <li>
                <a href="">chef_habitat</a>
                <ul class="menu vertical nested">
                  
                    
                      <li>
                        <a href="/habitat/" >
                          About Chef Habitat
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/community/" >
                          Chef Habitat Community
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/supported_platforms/" >
                          Supported Packages &amp; Platforms
                        </a>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>
                <a href="">chef_habitat/builder</a>
                <ul class="menu vertical nested">
                  
                    
                      <li>
                        <a href="/habitat/automated-builds/" >
                          Automated Builds
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/build-helpers/" >
                          Build Helpers
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/build-phase-callbacks/" >
                          Build Phase Callbacks
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/multiple-plans-builder/" >
                          Building Multiple Packages
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/habitat-and-continuous-integration/" >
                          Chef Habitat and Continuous Integration
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/builder-architecture/" >
                          Chef Habitat Builder Architecture
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/continuous-deployment/" >
                          Continuous Deployment
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/builder-account/" >
                          Create a Builder Account
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/builder-token/" >
                          Personal Access Token Management
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/builder-origin/" >
                          Create an Origin on Builder
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/origin-secrets/" >
                          Origin Secrets
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/sharing-pkgs/" >
                          Upload and Promote Packages
                        </a>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>
                <a href="">chef_habitat/containers</a>
                <ul class="menu vertical nested">
                  
                    
                      <li>
                        <a href="/habitat/ecs-and-habitat/" >
                          Amazon ECS and Chef Habitat
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/mesos-dcos/" >
                          Apache Mesos and DC/OS
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/habitat-and-orchestration/" >
                          Chef Habitat and Container Orchestration
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/habitat-and-containers/" >
                          Chef Habitat and Containers
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/habitat-and-others/" >
                          Chef Habitat and Other Software
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/habitat-and-provisioning/" >
                          Chef Habitat and Provisioning Tools
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/container-orchestration/" >
                          Container Orchestration
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/best-practices/" >
                          containers
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/gcr-and-habitat/" >
                          Google Container Registry (GCR)
                        </a>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>
                <a href="">chef_habitat/diagrams/package-build-flow</a>
                <ul class="menu vertical nested">
                  
                    
                      <li>
                        <a href="/habitat/package-build-flow/">Initial Package Build Flow</a>
                        <ul class="menu vertical nested">
                          
                            
                              <li>
                                <a href="/habitat/application-rebuild-flow/" >Application Rebuild Flow</a>
                              </li>
                            
                          
                            
                              <li>
                                <a href="/habitat/docker-automated-flow/" >Automate Docker Container Publishing Flow</a>
                              </li>
                            
                          
                            
                              <li>
                                <a href="/habitat/kubernetes-flow/" >Chef Habitat and Kubernetes Overview</a>
                              </li>
                            
                          
                            
                              <li>
                                <a href="/habitat/architecture-overview/" >Architecture Overview</a>
                              </li>
                            
                          
                            
                              <li>
                                <a href="/habitat/on-prem-flow/" >Chef Habitat Builder on-prem Flow</a>
                              </li>
                            
                          
                            
                              <li>
                                <a href="/habitat/dependency-update-flow/" >Dependency Update Flow</a>
                              </li>
                            
                          
                            
                              <li>
                                <a href="/habitat/docker-flow/" >Docker Container Publishing Flow</a>
                              </li>
                            
                          
                            
                              <li>
                                <a href="/habitat/runtime-binding/" >Runtime Services Group Binding</a>
                              </li>
                            
                          
                        </ul>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>
                <a href="">chef_habitat/get_started</a>
                <ul class="menu vertical nested">
                  
                    
                      <li>
                        <a href="/habitat/install-habitat/" >
                          Install Chef Habitat
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/configure-workstation/" >
                          Configure the Chef Habitat CLI
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/installing-packages/" >
                          Get Chef Habitat
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/accept-the-license/" >
                          Accept the License
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/install-faq/" >
                          Download and Install FAQ
                        </a>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>
                <a href="">chef_habitat/glossary</a>
                <ul class="menu vertical nested">
                  
                    
                      <li>
                        <a href="/habitat/application-lifecycle-hooks/" >
                          Application Lifecycle Hooks
                        </a>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>
                <a href="">chef_habitat/integrations</a>
                <ul class="menu vertical nested">
                  
                    
                      <li>
                        <a href="/habitat/aks-and-habitat/" >
                          Azure Container Services (AKS)
                        </a>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>
                <a href="">chef_habitat/overview</a>
                <ul class="menu vertical nested">
                  
                    
                      <li>
                        <a href="/habitat/glossary-artifacts/" >
                          Artifacts
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/glossary-builder/" >
                          Builder
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/on-prem/" >
                          Builder on-prem
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/glossary-plan/" >
                          Chef Habitat Plans for Linux and Windows Systems
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/glossary-keys/" >
                          Keys
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/running-habitat-linux-containers/" >
                          Running Chef Habitat Linux Containers
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/running-habitat-servers/" >
                          Running Chef Habitat on Servers (Linux and Windows)
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/running-habitat-windows-containers/" >
                          Running Chef Habitat Windows Containers
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/glossary-services/" >
                          Services
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/glossary-studio/" >
                          Studio
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/glossary-supervisor/" >
                          Supervisor
                        </a>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>
                <a href="">chef_habitat/packages</a>
                <ul class="menu vertical nested">
                  
                    
                      <li>
                        <a href="/habitat/artifact-export-format/" >
                          Chef Habitat Artifact Export Formats
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/package-contents/" >
                          Chef Habitat Package Contents
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/developing-packages/" >
                          Developing Packages
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/iterative-development/" >
                          Iterative Package Development
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/pkg-exports/" >
                          Package Export Formats
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/using-packages/" >
                          Running Chef Habitat Packages
                        </a>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>
                <a href="">chef_habitat/pattern_library</a>
                <ul class="menu vertical nested">
                  
                    
                      <li>
                        <a href="/habitat/pattern-library/" >
                          Pattern Library
                        </a>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>
                <a href="">chef_habitat/plans</a>
                <ul class="menu vertical nested">
                  
                    
                      <li>
                        <a href="/habitat/planwriting-guide/" >
                          Advanced Plan Writing Guide
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/glossary-hooks/" >
                          Application Lifecycle Hooks
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/binary-wrapper/" >
                          Binary Wrapper Packages
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/plan-builds/" >
                          Build
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/plan-templates/" >
                          Configuration Templates
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/pkg-binds/" >
                          Service Binds
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/plan-helpers/" >
                          Plan Helpers
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/plan-settings/" >
                          Plan Settings
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/plan-variables/" >
                          Plan Variables
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/glossary-scaffolding/" >
                          Scaffolding
                        </a>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>
                <a href="">chef_habitat/reference</a>
                <ul class="menu vertical nested">
                  
                    
                      <li>
                        <a href="/habitat/reference/" >
                          Chef Habitat Reference Overview
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/using-custom-certs/" >
                          Custom Certificates
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/environment-variables/" >
                          Environment Variables
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/habitat-cli/" >
                          hab CLI Reference
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/template-data/" >
                          Runtime Configuration Settings
                        </a>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>
                <a href="">chef_habitat/services</a>
                <ul class="menu vertical nested">
                  
                    
                      <li>
                        <a href="/habitat/file-uploads/" >
                          File Uploads
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/monitor-services/" >
                          Monitoring Services
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/config-updates/" >
                          Service Updates
                        </a>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>
                <a href="">chef_habitat/supervisiors</a>
                <ul class="menu vertical nested">
                  
                    
                      <li>
                        <a href="/habitat/robust-supervisor-networks/" >
                          Supervisor Networks
                        </a>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>
                <a href="">chef_habitat/supervisor</a>
                <ul class="menu vertical nested">
                  
                    
                      <li>
                        <a href="/habitat/internals/" >
                          Chef Habitat Internals
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/glossary-launcher/" >
                          Launcher
                        </a>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>
                <a href="">chef_habitat/supervisors</a>
                <ul class="menu vertical nested">
                  
                    
                      <li>
                        <a href="/habitat/remote-control/" >
                          Control Supervisors Remotely
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/using-encryption/" >
                          Securing Supervisor Networks
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/using-updates/" >
                          Service Group Update Strategy
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/setting-up-a-ring/" >
                          Setting Up a Ring
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/sup-log-configuration/" >
                          Supervisor Log Configuration
                        </a>
                      </li>
                    
                  
                    
                      <li>
                        <a href="/habitat/sup-log-keys/" >
                          Supervisor Log Key
                        </a>
                      </li>
                    
                  
                </ul>
              </li>
            
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
      </ul>
      <ul class="vertical menu accordion-menu show-for-small-only" data-accordion-menu>
        
          <li>
            <a href="https://www.chef.io/"  class="external" target="_blank">
            Chef.io
          </a>
          </li>
        
          <li>
            <a href="https://learn.chef.io/"  class="external" target="_blank">
            Learn Chef
          </a>
          </li>
        
          <li>
            <a href="https://blog.chef.io/"  class="external" target="_blank">
            Blog
          </a>
          </li>
        
          <li>
            <a href="https://community.chef.io/"  class="external" target="_blank">
            Community
          </a>
          </li>
        
          <li>
            <a href="https://training.chef.io/"  class="external" target="_blank">
            Training
          </a>
          </li>
        
          <li>
            <a href="https://downloads.chef.io/"  class="external" target="_blank">
            Download
          </a>
          </li>
        
      </ul>
    </div>
  </nav>
</aside>

  </div>

  <div class="off-canvas-wrapper">
    <div class="grid-container">
      <div class="grid-x">

        <div class="cell position-left off-canvas-absolute reveal-for-medium col-sidebar" id="left-nav-on-canvas" data-off-canvas data-transition="overlap" >
            


<aside class="sticky sidebar" data-sticky data-top-anchor="utility-bar:bottom" data-btm-anchor="footer:top">
  <nav id="sidebar-nav">
    <div class="nav">
      <ul class="vertical menu accordion-menu" data-accordion-menu>
        
          
          
        
          
          
        
          
          
            
              <li>

                <a href="">chef_habitat</a>
                <span class="menu_weight">Weight: 0</span>

                <ul class="menu vertical nested is-active">
                  
                    
                      <li  >
                        
                          <a href="/habitat/">About Chef Habitat</a>
                        
                        <span class="menu_weight">Weight: 10</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/community/">Chef Habitat Community</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/supported_platforms/">Supported Packages &amp; Platforms</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>

                <a href="">chef_habitat/builder</a>
                <span class="menu_weight">Weight: 0</span>

                <ul class="menu vertical nested is-active">
                  
                    
                      <li  >
                        
                          <a href="/habitat/automated-builds/">Automated Builds</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/build-helpers/">Build Helpers</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/build-phase-callbacks/">Build Phase Callbacks</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/multiple-plans-builder/">Building Multiple Packages</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/habitat-and-continuous-integration/">Chef Habitat and Continuous Integration</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/builder-architecture/">Chef Habitat Builder Architecture</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/continuous-deployment/">Continuous Deployment</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/builder-account/">Create a Builder Account</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/builder-token/">Personal Access Token Management</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/builder-origin/">Create an Origin on Builder</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/origin-secrets/">Origin Secrets</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/sharing-pkgs/">Upload and Promote Packages</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>

                <a href="">chef_habitat/containers</a>
                <span class="menu_weight">Weight: 0</span>

                <ul class="menu vertical nested is-active">
                  
                    
                      <li  >
                        
                          <a href="/habitat/ecs-and-habitat/">Amazon ECS and Chef Habitat</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/mesos-dcos/">Apache Mesos and DC/OS</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/habitat-and-orchestration/">Chef Habitat and Container Orchestration</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/habitat-and-containers/">Chef Habitat and Containers</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/habitat-and-others/">Chef Habitat and Other Software</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/habitat-and-provisioning/">Chef Habitat and Provisioning Tools</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/container-orchestration/">Container Orchestration</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/best-practices/">containers</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/gcr-and-habitat/">Google Container Registry (GCR)</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>

                <a href="">chef_habitat/diagrams/package-build-flow</a>
                <span class="menu_weight">Weight: 0</span>

                <ul class="menu vertical nested is-active">
                  
                    
                      <li>
                        <a href="/habitat/package-build-flow/">Initial Package Build Flow</a>
                        <span class = "menu_weight">Weight: 20</span>

                        <ul class="menu vertical nested">
                          

                            
                              <li>
                                
                                  <a href="/habitat/application-rebuild-flow/">Application Rebuild Flow</a>
                                
                                <span class="menu_weight">Weight: 20</span>
                              </li>
                            
                          

                            
                              <li>
                                
                                  <a href="/habitat/docker-automated-flow/">Automate Docker Container Publishing Flow</a>
                                
                                <span class="menu_weight">Weight: 20</span>
                              </li>
                            
                          

                            
                              <li>
                                
                                  <a href="/habitat/kubernetes-flow/">Chef Habitat and Kubernetes Overview</a>
                                
                                <span class="menu_weight">Weight: 20</span>
                              </li>
                            
                          

                            
                              <li>
                                
                                  <a href="/habitat/architecture-overview/">Architecture Overview</a>
                                
                                <span class="menu_weight">Weight: 20</span>
                              </li>
                            
                          

                            
                              <li>
                                
                                  <a href="/habitat/on-prem-flow/">Chef Habitat Builder on-prem Flow</a>
                                
                                <span class="menu_weight">Weight: 20</span>
                              </li>
                            
                          

                            
                              <li>
                                
                                  <a href="/habitat/dependency-update-flow/">Dependency Update Flow</a>
                                
                                <span class="menu_weight">Weight: 20</span>
                              </li>
                            
                          

                            
                              <li>
                                
                                  <a href="/habitat/docker-flow/">Docker Container Publishing Flow</a>
                                
                                <span class="menu_weight">Weight: 20</span>
                              </li>
                            
                          

                            
                              <li>
                                
                                  <a href="/habitat/runtime-binding/">Runtime Services Group Binding</a>
                                
                                <span class="menu_weight">Weight: 20</span>
                              </li>
                            
                          
                        </ul>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>

                <a href="">chef_habitat/get_started</a>
                <span class="menu_weight">Weight: 0</span>

                <ul class="menu vertical nested is-active">
                  
                    
                      <li  >
                        
                          <a href="/habitat/install-habitat/">Install Chef Habitat</a>
                        
                        <span class="menu_weight">Weight: 10</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/configure-workstation/">Configure the Chef Habitat CLI</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/installing-packages/">Get Chef Habitat</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/accept-the-license/">Accept the License</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/install-faq/">Download and Install FAQ</a>
                        
                        <span class="menu_weight">Weight: 30</span>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>

                <a href="">chef_habitat/glossary</a>
                <span class="menu_weight">Weight: 0</span>

                <ul class="menu vertical nested is-active">
                  
                    
                      <li  >
                        
                          <a href="/habitat/application-lifecycle-hooks/">Application Lifecycle Hooks</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>

                <a href="">chef_habitat/integrations</a>
                <span class="menu_weight">Weight: 0</span>

                <ul class="menu vertical nested is-active">
                  
                    
                      <li  >
                        
                          <a href="/habitat/aks-and-habitat/">Azure Container Services (AKS)</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>

                <a href="">chef_habitat/overview</a>
                <span class="menu_weight">Weight: 0</span>

                <ul class="menu vertical nested is-active">
                  
                    
                      <li  >
                        
                          <a href="/habitat/glossary-artifacts/">Artifacts</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/glossary-builder/">Builder</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/on-prem/">Builder on-prem</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/glossary-plan/">Chef Habitat Plans for Linux and Windows Systems</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/glossary-keys/">Keys</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/running-habitat-linux-containers/">Running Chef Habitat Linux Containers</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/running-habitat-servers/">Running Chef Habitat on Servers (Linux and Windows)</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/running-habitat-windows-containers/">Running Chef Habitat Windows Containers</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/glossary-services/">Services</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/glossary-studio/">Studio</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/glossary-supervisor/">Supervisor</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>

                <a href="">chef_habitat/packages</a>
                <span class="menu_weight">Weight: 0</span>

                <ul class="menu vertical nested is-active">
                  
                    
                      <li  >
                        
                          <a href="/habitat/artifact-export-format/">Chef Habitat Artifact Export Formats</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/package-contents/">Chef Habitat Package Contents</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/developing-packages/">Developing Packages</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/iterative-development/">Iterative Package Development</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/pkg-exports/">Package Export Formats</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/using-packages/">Running Chef Habitat Packages</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>

                <a href="">chef_habitat/pattern_library</a>
                <span class="menu_weight">Weight: 0</span>

                <ul class="menu vertical nested is-active">
                  
                    
                      <li  >
                        
                          <a href="/habitat/pattern-library/">Pattern Library</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>

                <a href="">chef_habitat/plans</a>
                <span class="menu_weight">Weight: 0</span>

                <ul class="menu vertical nested is-active">
                  
                    
                      <li  >
                        
                          <a href="/habitat/planwriting-guide/">Advanced Plan Writing Guide</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/glossary-hooks/">Application Lifecycle Hooks</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/binary-wrapper/">Binary Wrapper Packages</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/plan-builds/">Build</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/plan-templates/">Configuration Templates</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/pkg-binds/">Service Binds</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/plan-helpers/">Plan Helpers</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/plan-settings/">Plan Settings</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/plan-variables/">Plan Variables</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/glossary-scaffolding/">Scaffolding</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>

                <a href="">chef_habitat/reference</a>
                <span class="menu_weight">Weight: 0</span>

                <ul class="menu vertical nested is-active">
                  
                    
                      <li  >
                        
                          <a href="/habitat/reference/">Chef Habitat Reference Overview</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/using-custom-certs/">Custom Certificates</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/environment-variables/">Environment Variables</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/habitat-cli/">hab CLI Reference</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/template-data/">Runtime Configuration Settings</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>

                <a href="">chef_habitat/services</a>
                <span class="menu_weight">Weight: 0</span>

                <ul class="menu vertical nested is-active">
                  
                    
                      <li  >
                        
                          <a href="/habitat/file-uploads/">File Uploads</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/monitor-services/">Monitoring Services</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/config-updates/">Service Updates</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>

                <a href="">chef_habitat/supervisiors</a>
                <span class="menu_weight">Weight: 0</span>

                <ul class="menu vertical nested is-active">
                  
                    
                      <li  >
                        
                          <a href="/habitat/robust-supervisor-networks/">Supervisor Networks</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>

                <a href="">chef_habitat/supervisor</a>
                <span class="menu_weight">Weight: 0</span>

                <ul class="menu vertical nested is-active">
                  
                    
                      <li  >
                        
                          <a href="/habitat/internals/">Chef Habitat Internals</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/glossary-launcher/">Launcher</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                </ul>
              </li>
            
          
            
              <li>

                <a href="">chef_habitat/supervisors</a>
                <span class="menu_weight">Weight: 0</span>

                <ul class="menu vertical nested is-active">
                  
                    
                      <li  >
                        
                          <a href="/habitat/remote-control/">Control Supervisors Remotely</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/using-encryption/">Securing Supervisor Networks</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/using-updates/">Service Group Update Strategy</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/setting-up-a-ring/">Setting Up a Ring</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/sup-log-configuration/">Supervisor Log Configuration</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                    
                      <li  >
                        
                          <a href="/habitat/sup-log-keys/">Supervisor Log Key</a>
                        
                        <span class="menu_weight">Weight: 20</span>
                      </li>
                    
                  
                </ul>
              </li>
            
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
      </ul>
    </div>
  </nav>
</aside>

        </div>

        <div id="main-content" class="cell off-canvas-content cell auto" data-off-canvas-content>
            
<main id="main-content-col" tabindex="-1">
<div class="col-content">
  <div id="kubernetes-development-patterns"><h1>Kubernetes Development Patterns</h1></div>

  
  
    <button type="button" class="TOC-button hide-for-large" data-toggle="offCanvasRightTOC" data-close="left-nav-off-canvas">
      <i class="fas fa-bars"></i> Table of Contents
    </button>
  
    <div class="prose">
      <h1 id="a-namekubernetes-idkubernetes-data-magellan-targetkuberneteskubernetesa"><a name="kubernetes" id="kubernetes" data-magellan-target="kubernetes">Kubernetes</a></h1>
<p><a href="http://kubernetes.io/">Kubernetes</a> is an open source container cluster manager that is available as a stand-alone platform or embedded in several distributed platforms including <a href="https://cloud.google.com/container-engine/">Google&rsquo;s Container Engine</a>, <a href="https://aws.amazon.com/eks/">AWS Elastic Kubernetes Service</a>, <a href="https://azure.microsoft.com/services/kubernetes-service/">Azure Kubernetes Service</a>, and <a href="https://openshift.com/">Red Hat OpenShift</a>.
Chef Habitat and Kubernetes are complementary. While Kubernetes provides a platform for deployment, scaling, and operations of application containers across clusters of hosts, Chef Habitat manages the build pipeline and lifecycle of those application containers.</p>
<h2 id="chef-habitat-on-kubernetes">Chef Habitat on Kubernetes</h2>
<p>Chef Habitat can export your package as a Docker container that runs on Kubernetes in the form of a pod.
Additionally, a Chef Habitat bastion pod provides essential gossip ring features like service discovery (binds), secrets and the required <a href="/docs/best-practices/robust-supervisor-networks">initial peer</a> to all other pods.</p>
<p>Chef Habitat robustly deploys the bastion pod with a Kubernetes stateful set, persistent volume, and liveness checking, which ensures node availability and ring data persistence. The Kubernetes stateful set comes with an attached Kubernetes service that makes discoverable with DNS. Each namespace should contain a single service and stateful set.</p>
<h2 id="deploy-the-chef-habitat-bastion-on-kubernetes">Deploy the Chef Habitat Bastion on Kubernetes</h2>
<p>Complete examples may be downloaded from <a href="https://www.habitat.sh/docs/examples/kubernetes_hab_bastion/">this folder</a></p>
<p>To explain how this works, let&rsquo;s break down the hab-bastion.yaml file:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#007020;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#007020;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>Service<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#007020;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#007020;font-weight:bold">name</span>:<span style="color:#bbb"> </span>hab-bastion<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#007020;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#007020;font-weight:bold">ports</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#007020;font-weight:bold">name</span>:<span style="color:#bbb"> </span>gossip-listener<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#007020;font-weight:bold">protocol</span>:<span style="color:#bbb"> </span>UDP<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#007020;font-weight:bold">port</span>:<span style="color:#bbb"> </span><span style="color:#40a070">9638</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#007020;font-weight:bold">targetPort</span>:<span style="color:#bbb"> </span><span style="color:#40a070">9638</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#007020;font-weight:bold">name</span>:<span style="color:#bbb"> </span>http-gateway<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#007020;font-weight:bold">protocol</span>:<span style="color:#bbb"> </span>TCP<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#007020;font-weight:bold">port</span>:<span style="color:#bbb"> </span><span style="color:#40a070">9631</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#007020;font-weight:bold">targetPort</span>:<span style="color:#bbb"> </span><span style="color:#40a070">9631</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#007020;font-weight:bold">selector</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#007020;font-weight:bold">app</span>:<span style="color:#bbb"> </span>hab-bastion<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#007020;font-weight:bold">clusterIP</span>:<span style="color:#bbb"> </span>None<span style="color:#bbb">
</span></code></pre></div><p>This service definition creates a virtual IP (VIP), opening access to the Chef Habitat service that runs on the pod.</p>
<ul>
<li>The habitat gossip port (9638/UDP) listener</li>
<li>The habitat http-gateway (9631/TCP) listener</li>
<li>makes service name available in DNS (as <code>hab-bastion</code> or <code>hab-bastion.namespace-name</code>, etc) and discoverable by any pod</li>
</ul>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#007020;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>apps/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#007020;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>StatefulSet<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#007020;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#007020;font-weight:bold">name</span>:<span style="color:#bbb"> </span>hab-bastion<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#007020;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#007020;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#007020;font-weight:bold">securityContext</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#007020;font-weight:bold">fsGroup</span>:<span style="color:#bbb"> </span><span style="color:#40a070">42</span><span style="color:#bbb">
</span></code></pre></div><p>This section sets the group ownership for the persistent volume mount point so the Habitat Supervisor can write to it.  The Habitat user (<code>hab</code>) by default has the uid <code>42</code> and the gid <code>42</code>.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#bbb">      </span><span style="color:#007020;font-weight:bold">containers</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>- <span style="color:#007020;font-weight:bold">name</span>:<span style="color:#bbb"> </span>hab-bastion<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#007020;font-weight:bold">image</span>:<span style="color:#bbb"> </span>mydockerorigin/hab_bastion:latest<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#007020;font-weight:bold">args</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#4070a0">&#39;--permanent-peer&#39;</span><span style="color:#bbb">
</span></code></pre></div><p>The <code>image:</code> line defines the source of the docker container. In this case, the instructions create an image from a Chef Habitat plan using the <code>hab pkg export docker</code> command. It only runs the Chef Habitat Supervisor (hab-sup) service.
The argument <code>--permanent-peer</code> instructs the Supervisor to act as a permanent peer.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#bbb">        </span><span style="color:#007020;font-weight:bold">resources</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#007020;font-weight:bold">requests</span>:<span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#007020;font-weight:bold">memory</span>:<span style="color:#bbb"> </span><span style="color:#4070a0">&#34;100Mi&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#007020;font-weight:bold">cpu</span>:<span style="color:#bbb"> </span><span style="color:#4070a0">&#34;100m&#34;</span><span style="color:#bbb"> </span><span style="color:#60a0b0;font-style:italic"># equivalent to 0.1 of a CPU core</span><span style="color:#bbb">
</span></code></pre></div><p>Resource requests are important because they give instructions to the Kubernetes scheduler&ndash;without them, you might overload some nodes while under-using others.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#bbb">        </span><span style="color:#007020;font-weight:bold">ports</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#007020;font-weight:bold">name</span>:<span style="color:#bbb"> </span>gossip-listener<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#007020;font-weight:bold">protocol</span>:<span style="color:#bbb"> </span>UDP<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#007020;font-weight:bold">containerPort</span>:<span style="color:#bbb"> </span><span style="color:#40a070">9638</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#007020;font-weight:bold">name</span>:<span style="color:#bbb"> </span>http-gateway<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#007020;font-weight:bold">protocol</span>:<span style="color:#bbb"> </span>TCP<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#007020;font-weight:bold">containerPort</span>:<span style="color:#bbb"> </span><span style="color:#40a070">9631</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#007020;font-weight:bold">readinessProbe</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#007020;font-weight:bold">httpGet</span>:<span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#007020;font-weight:bold">path</span>:<span style="color:#bbb"> </span>/<span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#007020;font-weight:bold">port</span>:<span style="color:#bbb"> </span><span style="color:#40a070">9631</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#007020;font-weight:bold">initialDelaySeconds</span>:<span style="color:#bbb"> </span><span style="color:#40a070">5</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#007020;font-weight:bold">periodSeconds</span>:<span style="color:#bbb"> </span><span style="color:#40a070">10</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#007020;font-weight:bold">livenessProbe</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#007020;font-weight:bold">httpGet</span>:<span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#007020;font-weight:bold">path</span>:<span style="color:#bbb"> </span>/<span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#007020;font-weight:bold">port</span>:<span style="color:#bbb"> </span><span style="color:#40a070">9631</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#007020;font-weight:bold">initialDelaySeconds</span>:<span style="color:#bbb"> </span><span style="color:#40a070">15</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#007020;font-weight:bold">periodSeconds</span>:<span style="color:#bbb"> </span><span style="color:#40a070">20</span><span style="color:#bbb">
</span></code></pre></div><p>The <code>livenessProbe</code> tells Kubernetes if the pod is healthy or not.  If not, the pod gets restarted.
The <code>readinessProbe</code> signals to Kubernetes that the pod has started up successfully.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#bbb">        </span><span style="color:#007020;font-weight:bold">volumeMounts</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#007020;font-weight:bold">name</span>:<span style="color:#bbb"> </span>hab-bastion<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#007020;font-weight:bold">mountPath</span>:<span style="color:#bbb"> </span>/hab/sup<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#007020;font-weight:bold">volumeClaimTemplates</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#007020;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#007020;font-weight:bold">name</span>:<span style="color:#bbb"> </span>hab-bastion<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#007020;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#007020;font-weight:bold">accessModes</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span><span style="color:#4070a0">&#34;ReadWriteOnce&#34;</span><span style="color:#bbb"> </span>]<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#60a0b0;font-style:italic"># uncomment if you don&#39;t have a default StorageClass</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#60a0b0;font-style:italic"># storageClassName: &#34;standard&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#007020;font-weight:bold">resources</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#007020;font-weight:bold">requests</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#007020;font-weight:bold">storage</span>:<span style="color:#bbb"> </span>10Gi<span style="color:#bbb">
</span></code></pre></div><p>All of the Habitat Supervisor&rsquo;s state data is stored under <code>/hab/sup</code> - we mount this on a persistent volume so it gets re-attached if the pod is ever rescheduled. The data persists!</p>
<h2 id="create-a-kubernetes-deployment-that-works-with-the-bastion">Create a Kubernetes Deployment That Works with the Bastion</h2>
<p>The following is an example of a Kubernetes <code>Stateful Set</code> built from the CockroachDB plan. The Bastion pattern uses the <code>--peer hab-bastion</code> configuration arguments to instruct the Kubernetes pods to use the <code>hab-bastion</code> service as a DNS-resolvable host name.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">+++<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#007020;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>apps/v1<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#007020;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>StatefulSet<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#007020;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#007020;font-weight:bold">name</span>:<span style="color:#bbb"> </span>cockroachdb<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#007020;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#007020;font-weight:bold">selector</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#007020;font-weight:bold">matchLabels</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#007020;font-weight:bold">app</span>:<span style="color:#bbb"> </span>cockroachdb<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#007020;font-weight:bold">serviceName</span>:<span style="color:#bbb"> </span>cockroachdb<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#007020;font-weight:bold">replicas</span>:<span style="color:#bbb"> </span><span style="color:#40a070">3</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#007020;font-weight:bold">template</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#007020;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#007020;font-weight:bold">labels</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#007020;font-weight:bold">app</span>:<span style="color:#bbb"> </span>cockroachdb<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#007020;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#007020;font-weight:bold">terminationGracePeriodSeconds</span>:<span style="color:#bbb"> </span><span style="color:#40a070">10</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#007020;font-weight:bold">securityContext</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#007020;font-weight:bold">fsGroup</span>:<span style="color:#bbb"> </span><span style="color:#40a070">42</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#007020;font-weight:bold">containers</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>- <span style="color:#007020;font-weight:bold">name</span>:<span style="color:#bbb"> </span>cockroachdb<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#007020;font-weight:bold">image</span>:<span style="color:#bbb"> </span>irvingpop/cockroach:latest<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#007020;font-weight:bold">args</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- --peer<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- hab-bastion<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- --topology<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- leader<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#007020;font-weight:bold">resources</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#007020;font-weight:bold">requests</span>:<span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#007020;font-weight:bold">memory</span>:<span style="color:#bbb"> </span><span style="color:#4070a0">&#34;300Mi&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span><span style="color:#007020;font-weight:bold">cpu</span>:<span style="color:#bbb"> </span><span style="color:#4070a0">&#34;500m&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#007020;font-weight:bold">ports</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#007020;font-weight:bold">name</span>:<span style="color:#bbb"> </span>http<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#007020;font-weight:bold">containerPort</span>:<span style="color:#bbb"> </span><span style="color:#40a070">8080</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#007020;font-weight:bold">name</span>:<span style="color:#bbb"> </span>cockroachdb<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#007020;font-weight:bold">containerPort</span>:<span style="color:#bbb"> </span><span style="color:#40a070">26257</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#007020;font-weight:bold">volumeMounts</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#007020;font-weight:bold">name</span>:<span style="color:#bbb"> </span>cockroachdb-data<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#007020;font-weight:bold">mountPath</span>:<span style="color:#bbb"> </span>/hab/svc/cockroach/data<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#007020;font-weight:bold">volumeClaimTemplates</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#007020;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#007020;font-weight:bold">name</span>:<span style="color:#bbb"> </span>cockroachdb-data<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#007020;font-weight:bold">spec</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#007020;font-weight:bold">accessModes</span>:<span style="color:#bbb"> </span>[<span style="color:#bbb"> </span><span style="color:#4070a0">&#34;ReadWriteOnce&#34;</span><span style="color:#bbb"> </span>]<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#007020;font-weight:bold">resources</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#007020;font-weight:bold">requests</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#007020;font-weight:bold">storage</span>:<span style="color:#bbb"> </span>10Gi<span style="color:#bbb">
</span></code></pre></div><h2 id="bare-kubernetes">Bare Kubernetes</h2>
<p>If your packages don&rsquo;t require communication with the Chef Habitat Supervisor ring, such as binds, secrets, etc., then you can execute your packages directly on the cluster. You can deploy Chef Habitat packages exported as containers to Kubernetes with the <a href="http://kubernetes.io/docs/user-guide/pods/single-container/"><code>kubectl</code> command</a>. Using the <a href="/docs/developing-packages#pkg-exports">Docker exporter</a> to create a containerized application, you can launch the container like this example:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ kubectl run mytutorial --image<span style="color:#666">=</span>myorigin/mytutorial --port<span style="color:#666">=</span><span style="color:#40a070">8080</span>
</code></pre></div><p>Assuming you&rsquo;re using the Docker image pulled from <code>myorigin/mytutorial</code>, port 8080 on the container should be accessible. Pass networking ports exposed by Chef Habitat with <code>kubectl run</code> as <code>--port</code> options. In this example, the <code>kubectl get</code> command is:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ kubectl get pods -l <span style="color:#bb60d5">run</span><span style="color:#666">=</span>mytutorial
</code></pre></div><h2 id="docker-and-aci">Docker and ACI</h2>
<p>Chef Habitat packages can be exported in both Docker and ACI formats (as well as others). Kubernetes currently supports the Docker runtime and integration of the rkt container runtime (an implementation of the App Container spec) is under active development.</p>
<h2 id="environment-variables-and-networking">Environment Variables and Networking</h2>
<p>Kubernetes supports passing <a href="http://kubernetes.io/docs/user-guide/environment-guide/">environment variables</a> into containers, which can be done <a href="https://github.com/habitat-sh/habitat-operator/tree/master/examples/env-vars">via the Chef Habitat Operator</a>.</p>
<h2 id="multi-container-pods">Multi-container Pods</h2>
<p>Multi-container pod support through Chef Habitat is still under active development as part of the Chef Habitat Operator.</p>
<h2 id="related-reading">Related Reading</h2>
<ul>
<li><a href="/docs/developing-packages/#pkg-exports">Export a Chef Habitat package</a></li>
<li><a href="/docs/habitat-cli">Chef Habitat CLI</a></li>
</ul>

    </div>
  </div>
</main>

        </div>

        
        
          <div class="cell off-canvas position-right toc off-canvas-absolute reveal-for-large" id="onCanvasRightTOC" data-off-canvas >
            <aside class="sticky sidebar" data-sticky data-top-anchor="utility-bar:bottom" data-btm-anchor="footer:top">
  <span>
    <strong>
      <h4 class="mini-toc-header">Table Of Contents</h4>
    </strong>
    <button class="close-button hide-for-large" aria-label="Close menu" type="button" data-close>
      <span aria-hidden="true">&times;</span>
    </button>
  </span>
  <a href="#kubernetes-development-patterns">Kubernetes Development Patterns</a><nav id="TableOfContents">
  <ul>
    <li><a href="#a-namekubernetes-idkubernetes-data-magellan-targetkuberneteskubernetesa"><a name="kubernetes" id="kubernetes" data-magellan-target="kubernetes">Kubernetes</a></a>
      <ul>
        <li><a href="#chef-habitat-on-kubernetes">Chef Habitat on Kubernetes</a></li>
        <li><a href="#deploy-the-chef-habitat-bastion-on-kubernetes">Deploy the Chef Habitat Bastion on Kubernetes</a></li>
        <li><a href="#create-a-kubernetes-deployment-that-works-with-the-bastion">Create a Kubernetes Deployment That Works with the Bastion</a></li>
        <li><a href="#bare-kubernetes">Bare Kubernetes</a></li>
        <li><a href="#docker-and-aci">Docker and ACI</a></li>
        <li><a href="#environment-variables-and-networking">Environment Variables and Networking</a></li>
        <li><a href="#multi-container-pods">Multi-container Pods</a></li>
        <li><a href="#related-reading">Related Reading</a></li>
      </ul>
    </li>
  </ul>
</nav></aside>

          </div>
        

      </div>
    </div>
  </div>

  
  

    <div class="off-canvas position-right toc off-canvas-absolute hide-for-large" id="offCanvasRightTOC" data-off-canvas
      data-transition="overlap">
      <aside class="sticky sidebar" data-sticky data-top-anchor="utility-bar:bottom" data-btm-anchor="footer:top">
  <span>
    <strong>
      <h4 class="mini-toc-header">Table Of Contents</h4>
    </strong>
    <button class="close-button hide-for-large" aria-label="Close menu" type="button" data-close>
      <span aria-hidden="true">&times;</span>
    </button>
  </span>
  <a href="#kubernetes-development-patterns">Kubernetes Development Patterns</a><nav id="TableOfContents">
  <ul>
    <li><a href="#a-namekubernetes-idkubernetes-data-magellan-targetkuberneteskubernetesa"><a name="kubernetes" id="kubernetes" data-magellan-target="kubernetes">Kubernetes</a></a>
      <ul>
        <li><a href="#chef-habitat-on-kubernetes">Chef Habitat on Kubernetes</a></li>
        <li><a href="#deploy-the-chef-habitat-bastion-on-kubernetes">Deploy the Chef Habitat Bastion on Kubernetes</a></li>
        <li><a href="#create-a-kubernetes-deployment-that-works-with-the-bastion">Create a Kubernetes Deployment That Works with the Bastion</a></li>
        <li><a href="#bare-kubernetes">Bare Kubernetes</a></li>
        <li><a href="#docker-and-aci">Docker and ACI</a></li>
        <li><a href="#environment-variables-and-networking">Environment Variables and Networking</a></li>
        <li><a href="#multi-container-pods">Multi-container Pods</a></li>
        <li><a href="#related-reading">Related Reading</a></li>
      </ul>
    </li>
  </ul>
</nav></aside>

    </div>

  

  <div id="footer" class="cell small-12">
    <div class="grid-x">
      <div class="cell small-12">
        <nav>
          
<footer id="footer">
  <div class="grid-container">
    <div class="grid-x align-middle">
      <div class="cell small-12 large-3 logo"><a href="/"><img src="/images/chef-logo-light.svg" alt="Habitat Documentation"></a></div>
      <div class="cell small-12 large-9">
        <ul class="menu vertical medium-horizontal">
          <li><a href="/sitemap/" target="_self">Site Map</a></li>
          <li><a href="https://www.chef.io/online-master-agreement/" target="_blank">Licensing</a></li>
          <li><a href="https://www.chef.io/terms-of-service/" target="_blank">Terms &amp; Conditions</a></li>
          <li><a href="https://www.chef.io/trademark-policy/" target="_blank">Trademark Policy</a></li>
          <li><a href="https://www.chef.io/privacy-policy/" target="_blank">Privacy Policy</a></li>
          <li><a href="https://www.chef.io/cookie-policy/" target="_blank">Cookie Policy</a></li>
        </ul>
        
          <p class="modified">Page Last Modified: 0001-01-01 00:00:00 &#43;0000 UTC</p>
        
        <p class="legal">&copy; 2008-2020 Chef Software, Inc. All Rights Reserved.</p>
      </div>
    </div>
  </div>
</footer>

        </nav>
      </div>
    </div>
  </div>
  
<script src="/js/core-bundle.min.b46adaaa9b34baa80cf4b98cb38321e111475886368cfc1e52ed3afcc03b5b22.js" type="text/javascript"></script>
<script src="/js/custom-bundle.min.e560508c0a1795f3e94b9dc46263787768b40136412317331f860cdc22837c6a.js" type="text/javascript"></script>
<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
  
  _st('install','s1Pemn_yrUKJw9_K5zRT','2.0.0');
</script>

  </body>
</html>
